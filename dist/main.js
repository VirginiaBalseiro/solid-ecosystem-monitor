(()=>{const t="https://api.github.com/repositories/186702057/contents/meetings",e=["template.md","README.md"],n=document.querySelector("main > article");let a=0;const r=(t,e)=>{const n=(e+1).toString();return`${t}-${1==n.length?`0${n}`:n}`};function i(t,e,r,i){var s=document.createElement("table");const o=document.createElement("caption");o.textContent=r,s.append(o);const d=document.createElement("tfoot"),c=document.createElement("tr"),l=document.createElement("td");l.colSpan=2;const p=document.createElement("dl"),m=document.createElement("dt"),h=document.createElement("dd");m.textContent="Number of meetings: ",h.textContent=a,p.appendChild(m),p.appendChild(h),l.appendChild(p),c.appendChild(l),d.appendChild(c);for(var u=document.createElement("thead"),f=document.createElement("tr"),g=0;g<e.length;g++){var x=document.createElement("th");x.textContent=e[g],f.appendChild(x)}u.appendChild(f);var C=document.createElement("tbody");t.forEach((t=>{i(t,C)})),s.appendChild(u),s.appendChild(C),s.appendChild(d),n.appendChild(s)}function s(e,r,i,s,o,d,c){const l=Math.max(20*e.length,n.getBoundingClientRect().width)-50-30,p=360,m=document.createElement("div");m.id=r,m.classList.add("chart");const h=document.createElement("h2");h.textContent=c,n.appendChild(h),n.appendChild(m);const u=d3.select(`#${r}`).append("svg").attr("width",l+50+30).attr("height",500).append("g").attr("transform","translate(50,20)"),f=u.append("g").attr("class","legend"),g=f.append("text").attr("x",0).attr("y",20);g.append("tspan").html(`Source: <a href="${t}">${t}</a>`).style("font-size","12px").attr("x",0),g.append("tspan").html(`Number of meetings: ${a}`).style("font-size","12px").attr("x",0).attr("dy","1.2em"),g.attr("transform",`translate(${l-f.node().getBoundingClientRect().width}, 0)`),m.id=r,m.classList.add("chart"),h.textContent=c,n.appendChild(h),n.appendChild(m);const x=d3.scalePoint().domain(e.map((t=>t[i]))).range([0,l]),C=d3.scaleLinear().domain([0,d3.max(e,(t=>t[s]))]).nice().range([p,0]),y=d3.line().x((t=>x(t[i]))).y((t=>C(t[s]))),b=d3.select(`#${r}`).append("div").attr("class","tooltip").style("position","absolute").style("opacity",0);u.append("path").datum(e).attr("class","line").attr("fill","none").attr("stroke","blue").attr("stroke-width",2).attr("d",y),u.append("g").attr("class","x-axis").attr("transform","translate(0, 360)").call((function(t){t.call(d3.axisBottom(x)).selectAll("text").style("text-anchor","end").attr("dx","-0.8em").attr("dy","0.15em").attr("transform","rotate(-45)")})),u.append("g").attr("class","y-axis").call(d3.axisLeft(C)),u.append("text").attr("x",l/2).attr("y",440).attr("text-anchor","middle").text(o),u.append("text").attr("transform","rotate(-90)").attr("x",-180).attr("y",-50).attr("dy","1em").style("text-anchor","middle").text(d),u.selectAll(".dot").data(e).enter().append("circle").attr("class","dot").attr("cx",(t=>x(t[i]))).attr("cy",(t=>C(t[s]))).attr("r",5).style("fill","blue").on("mouseover",((t,e)=>{b.transition().duration(200).style("opacity",.9);const n=b.node().offsetWidth,a=b.node().offsetHeight,r=t.pageX-n/2,c=t.pageY-a-10;b.html(`<strong>${o}:</strong> ${e[i]}<br><strong>${d}:</strong> ${e[s]}`).style("left",r+"px").style("top",c+"px")})).on("mouseout",(()=>{b.transition().duration(500).style("opacity",0)}))}function o(e,r,i,s,o,d,c){const l=100,p=Math.max(20*e.length,n.getBoundingClientRect().width)-l-60,m=320,h=document.createElement("div");h.id=r,h.classList.add("chart");const u=document.createElement("h2");u.textContent=c,n.appendChild(u),n.appendChild(h);var f=d3.select(`#${r}`).append("svg").attr("width",p+l+60).attr("height",500).append("g").attr("transform","translate(100,60)");const g=f.append("g").attr("class","legend"),x=g.append("text").attr("x",0).attr("y",20);x.append("tspan").html(`Source: <a href="${t}">${t}</a>`).style("font-size","12px").attr("x",0),x.append("tspan").html(`Number of meetings: ${a}`).style("font-size","12px").attr("x",0).attr("dy","1.2em"),x.attr("transform",`translate(${p-g.node().getBoundingClientRect().width}, 0)`);var C=d3.scaleBand().range([0,p]).padding(.1),y=d3.scaleLinear().range([m,0]);C.domain(e.map((function(t){return t[i]}))),y.domain([0,d3.max(e,(function(t){return t[s]}))]);const b=d3.select(`#${r}`).append("div").attr("class","tooltip").style("position","absolute").style("opacity",0);f.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",(function(t){return C(t[i])})).attr("width",C.bandwidth()).attr("y",(function(t){return y(t[s])})).attr("height",(function(t){return m-y(t[s])})).style("fill","blue").on("mouseover",(function(t,e){b.style("opacity",1);const n=b.node().offsetWidth,a=b.node().offsetHeight,r=t.pageX-n/2,o=t.pageY-a-10;b.html(`<strong>${e[i]}</strong> <br><strong>${d}:</strong> ${e[s]}`).style("left",r+"px").style("top",o+"px")})).on("mouseout",(function(){b.style("opacity",0)})),f.append("g").attr("class","x-axis").attr("transform","translate(0,320)").call(d3.axisBottom(C)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)"),f.append("g").attr("class","y-axis").call(d3.axisLeft(y)),f.append("text").attr("x",p/2).attr("y",440).style("text-anchor","middle").text(o),f.append("text").attr("x",-160).attr("y",-50).attr("transform","rotate(-90)").style("text-anchor","middle").text(d)}function d(t){const e=t.split("\n");let n=!1,a=0,r=[];const i=/\[([^\]]+)\]\([^)]+\)|\[([^\]]+)\]\([^\)]+\)|([^(]+)\s*\(([^)]+)\)|([^-]+)\s*-\s+([^-\s]+)|([^-]+) - \(([^)]+)\)|([^-]+) - ([^-]+)/;for(const t of e)if(t.startsWith("## Present"))n=!0;else if(n&&(t.startsWith("-")||t.startsWith("*"))){if(a++,"---"===t)break;const e=t.match(i);if(!e){let e=0;t.startsWith("*")?e=t.indexOf("*")+1:t.startsWith("-")&&(e=t.indexOf("-")+1),t.includes(",")?r.push(t.substring(e,t.indexOf(",")).trim()):r.push(t.substring(e).trim())}if(e)for(let t=1;t<=8;t++)if(e[t]){let n=e[t].trim();if(n.startsWith("[")&&n.endsWith("]")){const t=n.match(/\[([^\]]+)\]/);t&&(n=t[1].trim())}n.match(/\s-\s/)&&!n.match(/\S+\s-\s\S+/)&&(n=n.split(" - ")[0]),n.includes(",")&&(n=n.split(",")[0]),n=n.replace(/[\*\[\]]/g,"").replace(/-\s*$/,""),r.push(n.trim());break}}else if(n&&a>0&&""===t.trim())break;return{participantsCount:a,present:r}}function c(t){const e=t.split("\n");let n=!1,a=[];for(const t of e)if(t.endsWith("## Scribes"))n=!0;else if(n&&(t.startsWith("-")||t.startsWith("*")))a.push(t.substring(t.indexOf(" ")+1));else if(n&&""===t.trim())break;return a}!async function(){let l=!0;const p=document.createElement("div");p.id="progress-indicator-container";const m=document.createElement("progress"),h=document.createElement("label");h.setAttribute("for","progress-indicator"),h.textContent="Fetching data...",m.id="progress-indicator",m.value=0,m.max=100,p.appendChild(h),p.appendChild(m);try{const h=await fetch(t,{method:"GET"});if(l&&n.appendChild(p),h.ok){l=!1;const t=await h.json();a=t.length;const x=[],C=[],y=100/t.length;for(const n of t)if(m.value+=y,"file"===n.type&&n.name.endsWith(".md")&&!e.includes(n.name)){const t=n.download_url;let e;try{const a=await fetch(t);if(a.ok){e=await a.text();const{participantsCount:t,present:r}=d(e),i=c(e);C.push(...i),x.push({file:n,participantsCount:t,presentList:r})}}catch(t){return console.error("Error:",t.message),0}}const b={},v={};C.forEach((t=>{b[t]||(b[t]=0),b[t]=b[t]+1}));var u={};x.forEach((function(t){t.presentList.forEach((function(t){u[t]||(u[t]=0),u[t]++}))})),Object.keys(u).forEach((function(t){var e=u[t];v[t]=e}));const E=x.reduce(((t,e)=>{const n=new Date(e.file.name.substr(0,e.file.name.indexOf(".md"))),a=n.getFullYear(),r=n.getMonth(),i=`${a}-${r}`;return t[i]?(t[i].totalParticipantsCount+=e.participantsCount,t[i].fileCount+=1):t[i]={year:a,month:r,totalParticipantsCount:e.participantsCount,fileCount:1},t}),{}),$=Object.values(E).map((t=>({year:t.year,month:t.month,averageParticipantsCount:Math.floor(t.totalParticipantsCount/t.fileCount)})));if(!l){n.removeChild(p),i(x,["Meeting","Participants"],"Meeting participation",((t,e)=>{var n=document.createElement("tr");n.setAttribute("about","#"+t.file.sha),n.setAttribute("typeof","qb:Observation");var a=document.createElement("td");a.setAttribute("property","sdmx-dimension:refPeriod"),a.setAttribute("datatype","xsd:date");var r=document.createElement("a");r.href=t.file.html_url,r.textContent=t.file.name.slice(0,-3),a.appendChild(r),n.appendChild(a);var i=document.createElement("td");i.setAttribute("property","sdmx-measure:obsValue"),i.setAttribute("datatype","xsd:int"),i.textContent=t.participantsCount,n.appendChild(i),e.appendChild(n)})),s(x.map((t=>({date:t.file.name.substr(0,t.file.name.indexOf(".md")),participantsCount:t.participantsCount}))),"line-chart-meetings","date","participantsCount","Meeting","Participants","Meeting participation"),i($,["Month","Average Participants"],"Average monthly participation",((t,e)=>{var n=document.createElement("tr"),a=document.createElement("td");a.textContent=r(t.year,t.month),n.appendChild(a);var i=document.createElement("td");i.textContent=`${Math.floor(t.averageParticipantsCount)}`,n.appendChild(i),e.appendChild(n)})),s($.map((t=>({month:r(t.year,t.month),averageParticipantsCount:t.averageParticipantsCount}))),"line-chart-monthly","month","averageParticipantsCount","Month","Average Participants","Average monthly participation");var f=Object.keys(b).map((t=>({Name:t,"Meetings scribed":b[t]}))).filter((t=>t.Name.length&&"name"!==t.Name));f.sort(((t,e)=>e["Meetings scribed"]-t["Meetings scribed"])),i(f,["Name","Meetings scribed"],"Scribes",((t,e)=>{var n=document.createElement("tr"),a=document.createElement("td");a.textContent=t.Name,n.appendChild(a);var r=document.createElement("td");r.textContent=t["Meetings scribed"],n.appendChild(r),e.appendChild(n)})),o(f,"scribes-bar-chart","Name","Meetings scribed","Name","Meetings Scribed","Scribes");var g=Object.keys(v).map((t=>({Name:t,"Meetings present":v[t]}))).filter((t=>t.Name.length&&"name"!==t.Name));g.sort(((t,e)=>e["Meetings present"]-t["Meetings present"])),i(g,["Name","Meetings present"],"Attendance per participant",((t,e)=>{var n=document.createElement("tr"),a=document.createElement("td");a.textContent=t.Name,n.appendChild(a);var r=document.createElement("td");r.textContent=t["Meetings present"],n.appendChild(r),e.appendChild(n)})),o(g,"present-bar-chart","Name","Meetings present","Name","Meetings present","Attendance per participant")}}else console.error(`Failed to fetch directory contents. Status code: ${h.status}`)}catch(t){console.error("Error:",t.message)}}()})();