(()=>{const t="https://api.github.com/repositories/186702057/contents/meetings",e=["template.md","README.md"],a=document.querySelector("main > article");let n=0;const r=(t,e)=>{const a=(e+1).toString();return`${t}-${1==a.length?`0${a}`:a}`};function s(t,e,r,s){var i=document.createElement("table");const o=document.createElement("caption");o.textContent=r,i.append(o);const d=document.createElement("tfoot"),c=document.createElement("tr"),l=document.createElement("td");l.colSpan=2;const p=document.createElement("dl"),m=document.createElement("dt"),h=document.createElement("dd");m.textContent="Number of meetings: ",h.textContent=n,p.appendChild(m),p.appendChild(h),l.appendChild(p),c.appendChild(l),d.appendChild(c);for(var u=document.createElement("thead"),f=document.createElement("tr"),g=0;g<e.length;g++){var x=document.createElement("th");x.textContent=e[g],f.appendChild(x)}u.appendChild(f);var C=document.createElement("tbody");t.forEach((t=>{s(t,C)})),i.appendChild(u),i.appendChild(C),i.appendChild(d),a.appendChild(i)}function i(e,r,s,i,o,d,c){const l=Math.max(20*e.length,a.getBoundingClientRect().width)-50-30,p=360,m=document.createElement("div");m.id=r,m.classList.add("chart");const h=document.createElement("h2");h.textContent=c,a.appendChild(h),a.appendChild(m);const u=d3.select(`#${r}`).append("svg").attr("width",l+50+30).attr("height",500).append("g").attr("transform","translate(50,20)"),f=u.append("g").attr("class","legend"),g=f.append("text").attr("x",0).attr("y",20);g.append("tspan").html(`Source: <a href="${t}">${t}</a>`).style("font-size","12px").attr("x",0),g.append("tspan").html(`Number of meetings: ${n}`).style("font-size","12px").attr("x",0).attr("dy","1.2em"),g.attr("transform",`translate(${l-f.node().getBoundingClientRect().width}, 0)`),m.id=r,m.classList.add("chart"),h.textContent=c,a.appendChild(h),a.appendChild(m);const x=d3.scalePoint().domain(e.map((t=>t[s]))).range([0,l]),C=d3.scaleLinear().domain([0,d3.max(e,(t=>t[i]))]).nice().range([p,0]),y=d3.line().x((t=>x(t[s]))).y((t=>C(t[i]))),b=d3.select(`#${r}`).append("div").attr("class","tooltip").style("position","absolute").style("opacity",0);u.append("path").datum(e).attr("class","line").attr("fill","none").attr("stroke","blue").attr("stroke-width",2).attr("d",y),u.append("g").attr("class","x-axis").attr("transform","translate(0, 360)").call((function(t){t.call(d3.axisBottom(x)).selectAll("text").style("text-anchor","end").attr("dx","-0.8em").attr("dy","0.15em").attr("transform","rotate(-45)")})),u.append("g").attr("class","y-axis").call(d3.axisLeft(C)),u.append("text").attr("x",l/2).attr("y",440).attr("text-anchor","middle").text(o),u.append("text").attr("transform","rotate(-90)").attr("x",-180).attr("y",-50).attr("dy","1em").style("text-anchor","middle").text(d),u.selectAll(".dot").data(e).enter().append("circle").attr("class","dot").attr("cx",(t=>x(t[s]))).attr("cy",(t=>C(t[i]))).attr("r",5).style("fill","blue").on("mouseover",((t,e)=>{b.transition().duration(200).style("opacity",.9);const a=b.node().offsetWidth,n=b.node().offsetHeight,r=t.pageX-a/2,c=t.pageY-n-10;b.html(`<strong>${o}:</strong> ${e[s]}<br><strong>${d}:</strong> ${e[i]}`).style("left",r+"px").style("top",c+"px")})).on("mouseout",(()=>{b.transition().duration(500).style("opacity",0)}))}function o(e,r,s,i,o,d,c){const l=100,p=Math.max(20*e.length,a.getBoundingClientRect().width)-l-60,m=320,h=document.createElement("div");h.id=r,h.classList.add("chart");const u=document.createElement("h2");u.textContent=c,a.appendChild(u),a.appendChild(h);var f=d3.select(`#${r}`).append("svg").attr("width",p+l+60).attr("height",500).append("g").attr("transform","translate(100,60)");const g=f.append("g").attr("class","legend"),x=g.append("text").attr("x",0).attr("y",20);x.append("tspan").html(`Source: <a href="${t}">${t}</a>`).style("font-size","12px").attr("x",0),x.append("tspan").html(`Number of meetings: ${n}`).style("font-size","12px").attr("x",0).attr("dy","1.2em"),x.attr("transform",`translate(${p-g.node().getBoundingClientRect().width}, 0)`);var C=d3.scaleBand().range([0,p]).padding(.1),y=d3.scaleLinear().range([m,0]);C.domain(e.map((function(t){return t[s]}))),y.domain([0,d3.max(e,(function(t){return t[i]}))]);const b=d3.select(`#${r}`).append("div").attr("class","tooltip").style("position","absolute").style("opacity",0);f.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",(function(t){return C(t[s])})).attr("width",C.bandwidth()).attr("y",(function(t){return y(t[i])})).attr("height",(function(t){return m-y(t[i])})).style("fill","blue").on("mouseover",(function(t,e){b.style("opacity",1);const a=b.node().offsetWidth,n=b.node().offsetHeight,r=t.pageX-a/2,o=t.pageY-n-10;b.html(`<strong>${e[s]}</strong> <br><strong>${d}:</strong> ${e[i]}`).style("left",r+"px").style("top",o+"px")})).on("mouseout",(function(){b.style("opacity",0)})),f.append("g").attr("class","x-axis").attr("transform","translate(0,320)").call(d3.axisBottom(C)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)"),f.append("g").attr("class","y-axis").call(d3.axisLeft(y)),f.append("text").attr("x",p/2).attr("y",440).style("text-anchor","middle").text(o),f.append("text").attr("x",-160).attr("y",-50).attr("transform","rotate(-90)").style("text-anchor","middle").text(d)}async function d(t){try{const e=await fetch(t);if(e.ok){const t=(await e.text()).split("\n");let a=!1,n=0,r=[];const s=/\[([^\]]+)\]\([^)]+\)|\[([^\]]+)\]\([^\)]+\)|([^(]+)\s*\(([^)]+)\)|([^-]+)\s*-\s+([^-\s]+)|([^-]+) - \(([^)]+)\)|([^-]+) - ([^-]+)/;for(const e of t)if(e.startsWith("## Present"))a=!0;else if(a&&(e.startsWith("-")||e.startsWith("*"))){if(n++,"---"===e)break;const t=e.match(s);if(!t){let t=0;e.startsWith("*")?t=e.indexOf("*")+1:e.startsWith("-")&&(t=e.indexOf("-")+1),e.includes(",")?r.push(e.substring(t,e.indexOf(",")).trim()):r.push(e.substring(t).trim())}if(t)for(let e=1;e<=8;e++)if(t[e]){let a=t[e].trim();if(a.startsWith("[")&&a.endsWith("]")){const t=a.match(/\[([^\]]+)\]/);t&&(a=t[1].trim())}a.match(/\s-\s/)&&!a.match(/\S+\s-\s\S+/)&&(a=a.split(" - ")[0]),a.includes(",")&&(a=a.split(",")[0]),a=a.replace(/[\*\[\]]/g,"").replace(/-\s*$/,""),r.push(a.trim());break}}else if(a&&n>0&&""===e.trim())break;return{participantsCount:n,present:r}}return console.error(`Failed to fetch Markdown file. Status code: ${e.status}`),0}catch(t){return console.error("Error:",t.message),0}}async function c(t){try{const e=await fetch(t);if(e.ok){const t=(await e.text()).split("\n");let a=!1,n=[];for(const e of t)if(e.endsWith("## Scribes"))a=!0;else if(a&&(e.startsWith("-")||e.startsWith("*")))n.push(e.substring(e.indexOf(" ")+1));else if(a&&""===e.trim())break;return n}return console.error(`Failed to fetch Markdown file. Status code: ${e.status}`),0}catch(t){return console.error("Error:",t.message),0}}!async function(){let l=!0;const p=document.createElement("div");p.id="progress-indicator-container";const m=document.createElement("progress"),h=document.createElement("label");h.setAttribute("for","progress-indicator"),h.textContent="Fetching data...",m.id="progress-indicator",m.value=0,m.max=100,p.appendChild(h),p.appendChild(m);try{const h=await fetch(t,{method:"GET"});if(l&&a.appendChild(p),h.ok){l=!1;const t=await h.json();n=t.length;const x=[],C=[],y=100/t.length;for(const a of t)if(m.value+=y,"file"===a.type&&a.name.endsWith(".md")&&!e.includes(a.name)){const t=a.download_url,{participantsCount:e,present:n}=await d(t),r=await c(t);C.push(...r),x.push({file:a,participantsCount:e,presentList:n})}const b={},v={};C.forEach((t=>{b[t]||(b[t]=0),b[t]=b[t]+1}));var u={};x.forEach((function(t){t.presentList.forEach((function(t){u[t]||(u[t]=0),u[t]++}))})),Object.keys(u).forEach((function(t){var e=u[t];v[t]=e}));const E=x.reduce(((t,e)=>{const a=new Date(e.file.name.substr(0,e.file.name.indexOf(".md"))),n=a.getFullYear(),r=a.getMonth(),s=`${n}-${r}`;return t[s]?(t[s].totalParticipantsCount+=e.participantsCount,t[s].fileCount+=1):t[s]={year:n,month:r,totalParticipantsCount:e.participantsCount,fileCount:1},t}),{}),$=Object.values(E).map((t=>({year:t.year,month:t.month,averageParticipantsCount:Math.floor(t.totalParticipantsCount/t.fileCount)})));if(!l){a.removeChild(p),s(x,["Meeting","Participants"],"Meeting participation",((t,e)=>{var a=document.createElement("tr");a.setAttribute("about","#"+t.file.sha),a.setAttribute("typeof","qb:Observation");var n=document.createElement("td");n.setAttribute("property","sdmx-dimension:refPeriod"),n.setAttribute("datatype","xsd:date");var r=document.createElement("a");r.href=t.file.html_url,r.textContent=t.file.name.slice(0,-3),n.appendChild(r),a.appendChild(n);var s=document.createElement("td");s.setAttribute("property","sdmx-measure:obsValue"),s.setAttribute("datatype","xsd:int"),s.textContent=t.participantsCount,a.appendChild(s),e.appendChild(a)})),i(x.map((t=>({date:t.file.name.substr(0,t.file.name.indexOf(".md")),participantsCount:t.participantsCount}))),"line-chart-meetings","date","participantsCount","Meeting","Participants","Meeting participation"),s($,["Month","Average Participants"],"Average monthly participation",((t,e)=>{var a=document.createElement("tr"),n=document.createElement("td");n.textContent=r(t.year,t.month),a.appendChild(n);var s=document.createElement("td");s.textContent=`${Math.floor(t.averageParticipantsCount)}`,a.appendChild(s),e.appendChild(a)})),i($.map((t=>({month:r(t.year,t.month),averageParticipantsCount:t.averageParticipantsCount}))),"line-chart-monthly","month","averageParticipantsCount","Month","Average Participants","Average monthly participation");var f=Object.keys(b).map((t=>({Name:t,"Meetings scribed":b[t]}))).filter((t=>t.Name.length&&"name"!==t.Name));f.sort(((t,e)=>e["Meetings scribed"]-t["Meetings scribed"])),s(f,["Name","Meetings scribed"],"Scribes",((t,e)=>{var a=document.createElement("tr"),n=document.createElement("td");n.textContent=t.Name,a.appendChild(n);var r=document.createElement("td");r.textContent=t["Meetings scribed"],a.appendChild(r),e.appendChild(a)})),o(f,"scribes-bar-chart","Name","Meetings scribed","Name","Meetings Scribed","Scribes");var g=Object.keys(v).map((t=>({Name:t,"Meetings present":v[t]}))).filter((t=>t.Name.length&&"name"!==t.Name));g.sort(((t,e)=>e["Meetings present"]-t["Meetings present"])),s(g,["Name","Meetings present"],"Attendance per participant",((t,e)=>{var a=document.createElement("tr"),n=document.createElement("td");n.textContent=t.Name,a.appendChild(n);var r=document.createElement("td");r.textContent=t["Meetings present"],a.appendChild(r),e.appendChild(a)})),o(g,"present-bar-chart","Name","Meetings present","Name","Meetings present","Attendance per participant")}}else console.error(`Failed to fetch directory contents. Status code: ${h.status}`)}catch(t){console.error("Error:",t.message)}}()})();